# 🤖 Instructions Copilot - Cine API

## 🎯 CONTEXTE DU PROJET

**API NestJS** pour gestion de films et séries avec intégration TMDB.

### Stack technique :
- **Backend** : NestJS + TypeScript + Prisma + PostgreSQL
- **APIs externes** : TMDB
- **Base de données** : PostgreSQL avec modèles Movie/Serie
- **Dev server** : `npm run start:dev` sur port 3000

---

## 📋 RÈGLES DE REFACTORING

### ✅ **Autorisé sans confirmation :**
- Amélioration du code existant (clean code, performance)
- Ajout de commentaires et documentation
- Restructuration des fichiers/dossiers
- Optimisation des imports/exports
- Amélioration des types TypeScript
- Mise à jour des DTOs et validations

### ⚠️ **Interdictions strictes :**
- **NE PAS modifier les fonctionnalités existantes**
- **NE PAS changer les endpoints API**
- **NE PAS modifier le schéma Prisma sans accord**
- **NE PAS changer la structure des réponses JSON**

---

## 🔧 GESTION DES SERVEURS DE DÉVELOPPEMENT

### **Avant de lancer un nouveau serveur :**
1. ✅ Vérifier si un serveur tourne déjà (port 3000)
2. ✅ Utiliser le serveur existant si possible
3. ✅ Ne relancer que si nécessaire (changements config, erreurs)

### **Commandes de vérification :**
```bash
# Vérifier si le port 3000 est utilisé
lsof -i :3000

# Si serveur en arrière-plan, vérifier les logs
get_terminal_output <terminal_id>
```

---

## 🚀 RÈGLES D'EXÉCUTION DES COMMANDES

- ✅ Ne pas attendre d'appui sur "Continuer" pour les lignes de commande
- ✅ Enchaîner les commandes nécessaires pour accomplir la tâche

### **Exceptions nécessitant confirmation** :
- ⚠️ Suppression de fichiers importants
- ⚠️ Modification de configuration système
- ⚠️ Installation de nouvelles dépendances majeures
- ⚠️ Changements irréversibles

---

## 📁 STRUCTURE PROJET

```
src/
├── app.controller.ts      # Endpoints globaux (/search)
├── main.ts               # Configuration CORS et serveur
├── prisma.service.ts     # Service Prisma
├── movie/               # Module films
│   ├── movie.controller.ts
│   ├── movie.service.ts
│   └── dto/
├── serie/               # Module séries
│   ├── serie.controller.ts
│   ├── serie.service.ts
│   └── dto/
└── tmdb/                # Service TMDB externe
    └── tmdb.service.ts
```

---

## 🎨 BONNES PRATIQUES

### **Code Quality :**
- Utiliser les types TypeScript stricts
- Valider les DTOs avec class-validator
- Gérer les erreurs proprement
- Commentaires en français pour la logique métier

### **API Design :**
- Respecter les conventions REST
- Réponses JSON cohérentes
- Gestion d'erreurs unifiée
- Documentation des endpoints

### **Base de données :**
- Utiliser Prisma pour toutes les requêtes
- Gérer les relations correctement
- Optimiser les requêtes (include, select)

---

## 🔑 ENDPOINTS ACTUELS

### **Global**
- `GET /` - Message de bienvenue
- `GET /search?q=<query>&limit=<number>` - Recherche globale films/séries

### **Films (/movie)**
- `GET /movie` - Liste tous les films
- `GET /movie/wishlist` - Films en wishlist
- `GET /movie/rated` - Films notés
- `GET /movie/search?q=<query>&limit=<number>` - Recherche films
- `GET /movie/tmdb/:tmdbId` - Détails TMDB d'un film
- `GET /movie/:id` - Détails d'un film par ID local
- `POST /movie` - Créer un film
- `POST /movie/tmdb` - Créer/mettre à jour depuis TMDB
- `PUT /movie/:id` - Modifier un film
- `DELETE /movie/:id` - Supprimer un film

### **Séries (/serie)**
- `GET /serie` - Liste toutes les séries
- `GET /serie/wishlist` - Séries en wishlist
- `GET /serie/rated` - Séries notées
- `GET /serie/search?q=<query>&limit=<number>` - Recherche séries
- `GET /serie/tmdb/:tmdbId` - Détails TMDB d'une série
- `GET /serie/:id` - Détails d'une série par ID local
- `POST /serie` - Créer une série
- `POST /serie/tmdb` - Créer/mettre à jour depuis TMDB
- `PUT /serie/:id` - Modifier une série
- `DELETE /serie/:id` - Supprimer une série

---

## 📦 VARIABLES D'ENVIRONNEMENT

```env
DATABASE_URL=postgresql://...
TMDB_BEARER_TOKEN=...
CORS_ALLOWED_ORIGINS=/^https?:\/\/(localhost|127\.0\.0\.1):\d+$/
```

---

**Objectif :** Code propre, maintenable et performant tout en préservant les fonctionnalités existantes.
