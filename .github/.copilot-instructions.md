# ğŸ¤– Instructions Copilot - Cine API

## ğŸ¯ CONTEXTE DU PROJET

**API NestJS** pour gestion de films et sÃ©ries avec intÃ©gration TMDB.

### Stack technique :
- **Backend** : NestJS + TypeScript + Prisma + PostgreSQL
- **APIs externes** : TMDB
- **Base de donnÃ©es** : PostgreSQL avec modÃ¨les Movie/Serie
- **Dev server** : `npm run start:dev` sur port 3000

---

## ğŸ“‹ RÃˆGLES DE REFACTORING

### âœ… **AutorisÃ© sans confirmation :**
- AmÃ©lioration du code existant (clean code, performance)
- Ajout de commentaires et documentation
- Restructuration des fichiers/dossiers
- Optimisation des imports/exports
- AmÃ©lioration des types TypeScript
- Mise Ã  jour des DTOs et validations

### âš ï¸ **Interdictions strictes :**
- **NE PAS modifier les fonctionnalitÃ©s existantes**
- **NE PAS changer les endpoints API**
- **NE PAS modifier le schÃ©ma Prisma sans accord**
- **NE PAS changer la structure des rÃ©ponses JSON**

---

## ğŸ”§ GESTION DES SERVEURS DE DÃ‰VELOPPEMENT

### **Avant de lancer un nouveau serveur :**
1. âœ… VÃ©rifier si un serveur tourne dÃ©jÃ  (port 3000)
2. âœ… Utiliser le serveur existant si possible
3. âœ… Ne relancer que si nÃ©cessaire (changements config, erreurs)

### **Commandes de vÃ©rification :**
```bash
# VÃ©rifier si le port 3000 est utilisÃ©
lsof -i :3000

# Si serveur en arriÃ¨re-plan, vÃ©rifier les logs
get_terminal_output <terminal_id>
```

---

## ğŸš€ RÃˆGLES D'EXÃ‰CUTION DES COMMANDES

- âœ… Ne pas attendre d'appui sur "Continuer" pour les lignes de commande
- âœ… EnchaÃ®ner les commandes nÃ©cessaires pour accomplir la tÃ¢che

### **Exceptions nÃ©cessitant confirmation** :
- âš ï¸ Suppression de fichiers importants
- âš ï¸ Modification de configuration systÃ¨me
- âš ï¸ Installation de nouvelles dÃ©pendances majeures
- âš ï¸ Changements irrÃ©versibles

---

## ğŸ“ STRUCTURE PROJET

```
src/
â”œâ”€â”€ app.controller.ts      # Endpoints globaux (/search)
â”œâ”€â”€ main.ts               # Configuration CORS et serveur
â”œâ”€â”€ prisma.service.ts     # Service Prisma
â”œâ”€â”€ movie/               # Module films
â”‚   â”œâ”€â”€ movie.controller.ts
â”‚   â”œâ”€â”€ movie.service.ts
â”‚   â””â”€â”€ dto/
â”œâ”€â”€ serie/               # Module sÃ©ries
â”‚   â”œâ”€â”€ serie.controller.ts
â”‚   â”œâ”€â”€ serie.service.ts
â”‚   â””â”€â”€ dto/
â””â”€â”€ tmdb/                # Service TMDB externe
    â””â”€â”€ tmdb.service.ts
```

---

## ğŸ¨ BONNES PRATIQUES

### **Code Quality :**
- Utiliser les types TypeScript stricts
- Valider les DTOs avec class-validator
- GÃ©rer les erreurs proprement
- Commentaires en franÃ§ais pour la logique mÃ©tier

### **API Design :**
- Respecter les conventions REST
- RÃ©ponses JSON cohÃ©rentes
- Gestion d'erreurs unifiÃ©e
- Documentation des endpoints

### **Base de donnÃ©es :**
- Utiliser Prisma pour toutes les requÃªtes
- GÃ©rer les relations correctement
- Optimiser les requÃªtes (include, select)

---

## ğŸ”‘ ENDPOINTS PRINCIPAUX

- `GET /search` - Recherche globale films/sÃ©ries
- `GET|POST|PUT|DELETE /movie/*` - CRUD films
- `GET|POST|PUT|DELETE /serie/*` - CRUD sÃ©ries
- `POST /movie/tmdb` - CrÃ©ation depuis TMDB
- `POST /serie/tmdb` - CrÃ©ation depuis TMDB

---

## ğŸ“¦ VARIABLES D'ENVIRONNEMENT

```env
DATABASE_URL=postgresql://...
TMDB_BEARER_TOKEN=...
CORS_ALLOWED_ORIGINS=/^https?:\/\/(localhost|127\.0\.0\.1):\d+$/
```

---

**Objectif :** Code propre, maintenable et performant tout en prÃ©servant les fonctionnalitÃ©s existantes.
